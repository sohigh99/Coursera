<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>P4021 Causes CO Kernel Crash</title>
<!--     <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/styles.css"> -->
    <link href='https://fonts.googleapis.com/css?family=Oxygen:400,300,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Lora' rel='stylesheet' type='text/css'>

    <style>
      body {
        font-family: "Segoe UI", Calibri, Arial, Helvetica, sans-serif;
/*        background-color: #FFFAFA;*/
/*        font-size: 14px;*/
      }

      #myBtn {
        display: none;
        position: fixed;
        bottom: 20px;
        right: 30px;
        z-index: 99;
        font-size: 18px;*/
        border: none;
        outline: none;
        background-color: #2F4F4F;
        color: white;
        cursor: pointer;
        padding: 15px;
        border-radius: 4px;
      }

      #myBtn:hover {
        background-color: #555;
      }
        .kmnotebox {
        background-color: #FFFFE0;
        border-left: 10px;
        /*border-style: dotted;*/
      }

      .kmcodeblock {
        background-color: #B0E0E6;
        border-left: 10px;
        /*border-style: dotted;*/
      }

      
    </style>

  </head>


<body>
  <header>
    <nav id="header-nav" class="navbar navbar-default">
      <div class="container">
        <div class="navbar-header">
          <a href="index.html" class="pull-left visible-md visible-lg">
            <div id="logo-img"></div>
          </a>

          <div class="navbar-brand">
            <a href="../index.html"><h1>Home Page!</h1></a>
          </div>

<!--           <form>
            <input type="button" value="Go back!" onclick="history.back()">
          </form> -->

        </div>

      </div><!-- .container -->
    </nav><!-- #header-nav -->
  </header>

<button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>

<div style="background-color:#2F4F4F;color:white;padding:0px"><h1>P4021 Causes CO Kernel Crash</h1></div>
<!-- <div style="background-color:lightgrey;padding:30px 30px 2500px">This example demonstrates how to create a "scroll to top" button that becomes visible when the user starts to scroll the page.</div> -->

<script>
// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    document.getElementById("myBtn").style.display = "block";
  } else {
    document.getElementById("myBtn").style.display = "none";
  }
}

// When the user clicks on the button, scroll to the top of the document
function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>

</body>


<!-- <h1 class="km"><big><big><a name="subtitle"></a><span style="font-size: large;"><BIG>Caching in EnterpriseOne</BIG></span></big></big></h1> -->
<!-- ================================= Purpose of Document ================================== -->

<h2 class="km"><big><big><a name="section01"></a><span style="font-size: medium;"><BIG>Purpose of Document</BIG></span></big></big></h2>

<p><a href="&lt;&lt;INLINE_NOTE:1391796.2&gt;&gt;" alt="MRP Information Center" title="MRP Information Center" target="_blank">Information Center: Overview of JD Edwards EnterpriseOne Requirements Planning</a> &gt; <a href="&lt;&lt;INLINE_NOTE:1391801.2&gt;&gt;" alt="Troubleshooting MRP" title="Troubleshooting MRP" target="_blank">Information Center: Troubleshooting JD Edwards EnterpriseOne Requirements Planning </a>&gt; Note 839807.1<br /><br /> Call Object Kernel gets crashed in clicking find button through P4021 - Supply and Demand Inquiry for a specific item.</p>


<!-- ======================================== Body Starts Here =================================== -->

<h3 class="km">Error detail:</h3>
<p>Call Stack in AS400 reads as below, </p>
<p>Level Program Library Module Statement Procedure</p>
<div class="kmnotebox">0 JDELIB E812SYS JDEDEBUG jdelogCallStack <br />1 JDENET E812SYS NETSIG 0000000002Stack krnlCatchall <br />2 JDEUNICODE E812SYS JDEUNICODE 0000000006ll jdeStrcpy <br />3 CMFG PD812 B3400310 0000000043ll <strong>I3400310_SpreadQuantityAndWriteToCache </strong><br />4 CMFG PD812 B3400310 0000000082preadQuantityAndWriteToCache I3400310_GetAndSelectRatesSequentially <br />5 CMFG PD812 B3400310 0000000051etAndSelectRatesSequentially I3400310_GetAndSelectRates <br />6 CMFG PD812 B3400310 0000000151etAndSelectRates <span style="text-decoration: underline;"><strong>LoadSupplyAndDemandData</strong></span> <br />7 JDEKRNL E812SYS JDEOBJ 0000001477AndDemandData jdeCallObjectV2 <br />8 JDEKRNL E812SYS JDEOBJ 0000000001ectV2 jdeCallObject <br />9 JDEKRNL E812SYS JDEKNOBJ 0000000253ect JDEK_ProcessCallRequest <br />10 JDEKRNL E812SYS JDEKNOBJ 0000000071ssCallRequest JDEK_StartCallRequest <br />11 JDEKRNL E812SYS JDEKDISP 0000000006CallRequest runBusinessFunction <br />12 JDEKRNL E812SYS JDEKDISP 0000000003sFunction runCallObjectJob <br />13 JDEKRNL E812SYS JDEKDISP 0000000201ectJob JDEK_DispatchCallObjectMessage <br />14 XMLCALLOBJ E812SYS XMLCALLOBJ 0000000059tchCallObjectMessage XMLCallObjectDispatch <br />15 JDENET E812SYS NETFLOW 0000000083ectDispatch callDispatchFunction <br />16 JDENET E812SYS NETFLOW 0000000028chFunction kernelMsgThread <br />17 JDENET E812SYS NETFLOW 0000000001hread processKernelQueueMsg <br />18 JDENET E812SYS NETQUEUE 0000000038nelQueueMsg processKernelQueue <br />19 JDENET E812SYS NETPUB 0000000041nelQueue JDENET_RunKernel <br />20 JDENET_K E812SYS JDENET_K 0000000016Kernel main <br />21 JDENET_K E812SYS JDENET_K _C_pep <br />22 QP0ZPCPN QSYS QP0ZPCPN 0000000210Kernel InvokeTargetPgm__FP11qp0z_pcp_cb <br />23 QP0ZPCPN QSYS QP0ZPCPN 0000000266etPgm__FP11qp0z_pcp_cb Qp0zNewProcess <br />24 QP0ZPCP2 QSYS QP0ZPCP2 _CXX_PEP__Fv</div>
<h3 class="km">--- Cause ---</h3>
<p>*** Break In Code ***</p>
<div class="kmcodeblock" style="width: 95%;">idReturnCode = I3400310_F0007GetWorkDayCalendar1470(lpDS, lpdsB3400310Internal,&amp;nMonth, &amp;nYear, cDaysArray); <br />if (idReturnCode == ER_SUCCESS) <br />{ <br />  /* Weekly Schedule, Daily spread */ <br />  if (lpds4801t-&gt;cMonthWeekDayHour == _J('2')) <br />  { <br />    /*See if necessary to read next month calendar record */ <br />    if (lpdsB3400310Internal-&gt;dsF4801Columns.wadrqj.nMonth != lpdsB3400310Internal-&gt;dsF4801Columns.wastrt.nMonth) <br />    { <br />      jdeStrcpy(cDaysArray1, cDaysArray); <br />      nMonth = lpdsB3400310Internal-&gt;dsF4801Columns.wadrqj.nMonth; <br />      nYear = lpdsB3400310Internal-&gt;dsF4801Columns.wadrqj.nYear; <br />      idReturnCode = I3400310_F0007GetWorkDayCalendar1470(lpDS, lpdsB3400310Internal,&amp;nMonth, &amp;nYear, cDaysArray); <br />      jdeStrcpy(cDaysArray2, cDaysArray); <br />      jdeStrcpy(cDaysArray, cDaysArray1); <br />    }</div>
<p>*** Break In code *** <br />Issue is coming in dereferencing cDaysArray from 2nd calling when the days defined is 31 days.</p>
<p>as it the string array cDaysArray is defined as below,</p>
<div class="kmcodeblock" style="width: 95%;">/* copy first 32 cTypeOfDay fields into Days array */ <br />memcpy(&amp;cDaysArray[1], &amp;ds3000710.cTypeOfDayReturned01, (sizeof(JCHAR) * 31));</div>
<p>: cDaysArray[] can store upto 31 characters.  If 1 chracter is allocated for NULL Character, it can store up to 30, so if a certain month has 31 days not all data may be stored.</p>
<p>As a result,</p>
<div class="kmcodeblock" style="width: 95%;">jdeStrcpy(cDaysArray2, cDaysArray);</div>
<p>may contribute to a system crash.</p>
<h3 class="km">Issue may be resolved by setting as below:</h3>
<div class="kmcodeblock" style="width: 95%;">memcpy(&amp;cDaysArray[0], &amp;ds3000710.cTypeOfDayReturned01, (sizeof(JCHAR) * 31));</div>
<p>Set Array Index starts with 0 to hold 32 characters in the array cDaysArray[]</p>
<p>&lt;Internal_Only&gt; &lt;Bug:11019910&gt; not able to duplicate.<br />&lt;/Internal_Only&gt;</p>



<!-- ======================================== End of Body ==================================== -->

  <footer class="panel-footer">
    <div class="container">
      <div class="row">
        <section id="pagebottom" class="pagebottom">
          <!-- <p>"Click Top button to go back to the top"</p> -->
          <button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
          <form>
            <input type="button" value="Go back!" onclick="history.back()">
          </form>
        </section>
      </div>
      <div class="text-center">&copy; Copyright Dong's Page 2019</div>
    </div>
  </footer>

  <!-- jQuery (Bootstrap JS plugins depend on it) -->
  <script src="../js/jquery-2.1.4.min.js"></script>
  <script src="../js/bootstrap.min.js"></script>
  <script src="../js/script.js"></script>
</body>
</html>
